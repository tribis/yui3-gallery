YUI.add("gallery-datatable-footer",function(a){YUI.add("gallery-datatable-footer",function(b){var s=b.Node,c=b.Lang,n=b.Node.create,r=b.UA,t=1000000000000000,f="datatable",u="host",g="heading",e="col_keys",q="recordset",m="columnset",k="dtFooter",d=b.ClassNameManager.getClassName,o=d(f,"hd"),h=d(f,"liner"),i=d(f,"ft"),p='<div class="'+i+'"></div>';function l(v){l.superclass.constructor.apply(this,arguments);}b.mix(l,{NAME:"dataTableFooter",NS:"footer",ATTRS:{heading:{value:{colspan:1,label:"",className:""}},col_keys:{value:[],validator:c.isArray},fixed:{value:false,validator:c.isBoolean},dateFormat:{value:"%D",validator:c.isString},timeFormat:{value:"%T",validator:c.isString}}});b.extend(l,b.Plugin.Base,{_tfootContainer:null,_tfootNode:null,_tfootTrNode:null,_tfootThNode:null,initializer:function(){this.afterHostMethod("renderUI",this.renderPluginUI);this.afterHostMethod("bindUI",this.bindPluginUI);this.afterHostMethod("syncUI",this.syncPluginUI);},refreshFooter:function(){var x=this.get(u),w=x.get(m).keys,H=x.get(q),z=this.get(g),A=this.get(e),I=this._tfootNode.all("td");if(z.label){this._tfootThNode.one("div").setContent(this._doRecordSetMath(null,z.label));}for(j=0;j<A.length;j++){var v=A[j].key,E=null,G=null;var y=this._rtnColumnSetKeyIndex(w,v);if(y!==false){var C=y-this.get("heading.colspan");if(C>=0){E=I.item(C);G=E.one("div");var D=parseFloat(this._doRecordSetMath(A[j])),F=null;var B=A[j].formatter||w[y].get("formatter")||null;if(b.Lang.isFunction(B)){F=B.call(this,{value:D,record:{},column:w[j],tr:null,headers:null,classnames:null});}else{F=D;}if(G){G.setContent(F);}}}}},renderPluginUI:function(){this._buildFooterNodes();},bindPluginUI:function(){this.afterHostEvent("recordsetChange",this.syncPluginUI);this.afterHostEvent("recordset:recordsChange",this.syncPluginUI);this.afterHostEvent("recordset:update",this.syncPluginUI);},syncPluginUI:function(){this.refreshFooter();if(this.get(u).hasPlugin("scroll")&&this.get("fixed")){this._syncFooterWidths();}},_buildFooterNodes:function(){var x=this.get(u),w=x.get(m).keys,y=this.get(g),z=this.get(e),C=x._tableNode;if(!this.get(u).hasPlugin("scroll")&&this.get("fixed")){this.set("fixed",false);}if(this.get("fixed")){this._tfootContainer=x.get("contentBox").appendChild(n(p));C=this._tfootContainer.appendChild("<table/>");}this._tfootNode=C.appendChild(n("<tfoot/>"));this._tfootTrNode=this._tfootNode.appendChild(n("<tr/>"));this._tfootThNode=this._tfootTrNode.appendChild(n("<th/>"));tfdiv=this._tfootThNode.appendChild("<div/>");tfdiv.addClass(h);if(y.colspan){this._tfootThNode.setAttribute("colSpan",y.colspan);}if(y.className){tfdiv.addClass(y.className);}var A=(y.colspan)?y.colspan:0;for(;A<w.length;A++){var v=w[A].get("key");var D=this._tfootTrNode.appendChild(n("<td/>"));var E=D.appendChild(n("<div/>"));E.addClass(h);var B=this._indexOfObj(z,"key",v);if(B!==false){if(z[B].className){E.addClass(z[B].className);}}}return this._tfootNode;},_doRecordSetMath:function(y,z){var G=null;var x=this.get(u),w=x.get(m).keys,I=x.get(q);if(!y&&z){G=b.substitute(z,{ROW_COUNT:I.getLength(),COL_COUNT:w.length,DATE:b.DataType.Date.format(new Date(),{format:this.get("dateFormat")}),TIME:b.DataType.Date.format(new Date(),{format:this.get("timeFormat")})});}if(b.Lang.isObject(y)){var v=y.key,C=y.calc.toUpperCase(),H=0,J=-t,F=t,B=0;for(var D=0;D<I.getLength();D++){var A=I.getRecord(D),E=A.getValue();switch(C){case"{SUM}":case"{MEAN}":case"{AVG}":case"{AVERAGE}":H+=E[v];if(E[v]!==null){B++;}break;case"{MIN}":F=Math.min(F,E[v]);break;case"{MAX}":J=Math.max(J,E[v]);break;}}G=b.substitute(C,{SUM:H,MEAN:B>0?H/B:"#",AVG:B>0?H/B:"#",AVERAGE:B>0?H/B:"#",MIN:F,MAX:J,ROW_COUNT:I.getLength(),COL_COUNT:w.length,DATE:b.DataType.Date.format(new Date(),{format:this.get("dateFormat")}),TIME:b.DataType.Date.format(new Date(),{format:this.get("timeFormat")})});}return G;},_rtnColumnSetKeyIndex:function(w,v){for(var x=0;x<w.length;x++){if(w[x].get("key")===v){return x;}}return false;},_indexOfObj:function(v,y,w){for(var x=0;x<v.length;x++){if(v[x][y]===w){return x;}}return false;},_syncFooterWidths:function(){var x=this.get(u),z=x.get("contentBox").one("."+o),A=z.one("tr").all("."+h),D=this._tfootTrNode.all("."+h),E=(r.ie)?"offsetWidth":"clientWidth",F=null,v=0,y=this.get("heading.colspan");if(A&&A.size()){v=0;for(var B=0;B<y;B++){v+=A.item(B).get(E);}F=D.item(0);v-=(parseInt(F.getComputedStyle("paddingLeft"),10)|0)+(parseInt(F.getComputedStyle("paddingRight"),10)|0);var w=1;v+=w*(y-1);F.setStyle("width",v+"px");var B=y;for(;B<A.size();B++){v=A.item(B).get(E);var C=B-y+1;F=D.item(C);v-=(parseInt(F.getComputedStyle("paddingLeft"),10)|0)+(parseInt(F.getComputedStyle("paddingRight"),10)|0);D.item(C).setStyle("width",v+"px");}}}});b.namespace("Plugin");b.Plugin.DataTableFooter=l;},"gallery-2012.01.04-22-09",{requires:["datatable-base","datatype","plugin"]});},"gallery-2012.01.04-22-09",{skinnable:true,requires:["datatable-base","datatype","plugin"]});